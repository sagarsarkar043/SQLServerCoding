--Create Tables
--Employees
CREATE TABLE Employees (
    EmployeeID INT PRIMARY KEY,
    EmployeeName VARCHAR(100) NOT NULL,
    Department VARCHAR(50) NOT NULL,
    Email VARCHAR(100) NULL,
    PhoneNumber VARCHAR(15) NULL,
    ManagerID INT NULL,
    JoiningDate DATE NOT NULL,
    Salary DECIMAL(10,2) NULL
);


--Data Summary
--Email, PhoneNumber, ManagerID, Salary allow NULL
--EmployeeName, Department, JoiningDate are NOT NULL

CREATE TABLE S (
    SaleID INT PRIMARY KEY,
    EmployeeID INT NOT NULL,
    SaleDate DATE NOT NULL,
    SaleAmount DECIMAL(10,2) NULL,
    CustomerFeedback VARCHAR(200) NULL,
    FOREIGN KEY (EmployeeID) REFERENCES Employees(EmployeeID)
);

--Insert Sample Data (With NULLs)
--Employees
INSERT INTO Employees VALUES
(1, 'Amit Sharma', 'Sales', 'amit@company.com', '9876543210', NULL, '2023-01-10', 50000),
(2, 'Neha Verma', 'HR', NULL, '9876543222', 1, '2023-02-15', 40000),
(3, 'Rohit Singh', 'IT', 'rohit@company.com', NULL, 1, '2023-03-20', NULL),
(4, 'Anjali Mehta', 'Sales', NULL, NULL, 1, '2023-04-05', 55000),
(5, 'Suresh Iyer', 'Finance', 'suresh@company.com', '9876543333', NULL, '2023-05-12', 60000);

--Sales
INSERT INTO S VALUES
(101, 1, '2024-01-05', 25000, 'Good service'),
(102, 2, '2024-01-10', NULL, NULL),
(103, 3, '2024-01-15', 18000, 'Average'),
(104, 4, '2024-02-01', NULL, 'Delayed'),
(105, 1, '2024-02-10', 30000, NULL);

--Coalesce Function Demo

--Problem 1
/*
Display employee contact information.
If Email is missing, show PhoneNumber.
If both are missing, show Not Available.
--Business Use Case:Ensures HR always sees some contact information 
for employees.

*/

SELECT 
    EmployeeName,
    COALESCE(Email, PhoneNumber, 'Not Available') AS ContactInfo
FROM Employees;

--Problem 2
/*
Calculate total salary expense.
If salary is missing, consider it as 0.

Business Use Case:
Accurate payroll reporting even when salary data is incomplete.

*/

--Solution
SELECT 
    SUM(COALESCE(Salary, 0)) AS TotalSalaryExpense
FROM Employees;


-- Problem 3
/*
Show sales report with sale amount.
If sale amount is NULL, display 0 instead.

 Business Use Case:
Prevents NULL values from breaking financial dashboards.

*/

--Solution
SELECT 
    SaleID,
    SaleDate,
    COALESCE(SaleAmount, 0) AS SaleAmount
FROM S;

--Problem 4
/*
Identify employees’ managers.
If ManagerID is NULL, show ‘Top Management’.
Business Use Case:
Organizational hierarchy reporting.
*/

-- Solution
SELECT 
    EmployeeName,
    COALESCE(CAST(ManagerID AS VARCHAR(10)), 'Top Management') AS ManagerInfo
FROM Employees;


--Problem 5
/*
Show sales feedback.
If feedback is missing, display ‘No Feedback Provided’.
Business Use Case:
Standardized reporting output for management review.

*/
--Solution
SELECT 
    SaleID,
    COALESCE(CustomerFeedback, 'No Feedback Provided') AS Feedback
FROM S;

--COALESCE() can accept multiple columns, while ISNULL() accepts only two.

--Example: COALESCE(col1, col2, col3, 'Default')
